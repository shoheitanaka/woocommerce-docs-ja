---
post_title: Thumbnail image regeneration
---
# サムネイル画像再生

WooCommerce 3.3からサムネイル再生成機能が導入されました。これまでは画像サイズの設定を変更する場合、外部プラグインをインストールし、WordPressのすべての画像サムネイルを再生成してからでないと変更が表示されませんでした。

新しい画像再生機能とカスタマイザーでのWooCommerce画像設定の導入により、ストアの画像設定を変更する際、カスタマイザー内でリアルタイムに変更をプレビューできるようになりました。

## How it works

カスタマイザーで画像サイズ/アスペクト比を変更したり、テーマで画像サイズを変更したりすると、WCはこれらの変更を検出し、バックグラウンド再生成ジョブをキューに入れます。これをトリガーする2つのイベントは以下の通りです：

- カスタマイザーでの設定の公開
- テーマの切り替え

カスタマイザーでは、オンザフライで画像を更新するため、サイズの変更をプレビューすることができます。これらの変更は、公開をクリックするまで本番サイトには反映されません。

### バックグラウンド・ジョブとBasicAuth

あなたのサイトが BasicAuth の背後にある場合、非同期リクエストとバックグラウンド処理の両方が完了しません。これは WP Background Processing が WordPress HTTP API に依存しており、リクエストに BasicAuth 認証情報を添付する必要があるためです。

[BasicAuthのドキュメント](https://github.com/A5hleyRich/wp-background-processing#basicauth) を参照してください。

### バックグラウンド再生ログを見る

背景画像再生のログを表示するには、`WooCommerce > Status > Logs`に移動し、ドロップダウンから`wc-background-regeneration`ログを選択します。

このログファイルには、処理された画像と、ジョブがいつ完了したか、またはいつキャンセルされたかが一覧表示されます。

### バックグラウンド再生ジョブのキャンセル

WooCommerce 3.3.2以降、背景画像の再生成が実行されている場合、管理者に通知が表示されます。この通知の中にジョブをキャンセルするリンクがあります。

ジョブをキャンセルすると、それ以上サムネイルが再生成されなくなります。画像のサイズがカタログ内で正しく表示されない場合は、サムネイルの再生を手動で実行する必要があります（私たちのツールを使用するか、[Regenerate Thumbnails](https://en-gb.wordpress.org/plugins/regenerate-thumbnails/)のような別のプラグインを使用します）。

### CDN プラグイン

ほとんどのCDNプラグインはWordPressコアのフックをリッスンし、一度作成されたサムネイルをそのサービスにアップロードします。これは、私たちのバックグラウンド画像再生成コードで機能し続けます。画像がサードパーティのサービスにアップロードされるため、生成は遅くなるかもしれません。

## バックグラウンド再生を無効にする方法

`woocommerce_background_image_regeneration`フィルターは、バックグラウンド再生を完全に無効にするために使用できる。コード例：

```php
add_filter( 'woocommerce_background_image_regeneration', '__return_false' );
```

一度無効にすると、画像サイズの設定を変更して新しいサムネイルが必要になった場合、別のツールを使って手動でサムネイルを再生成する必要があります。

別の方法として、[Jetpack Photonモジュール](https://jetpack.com/support/photon/) を使用することもできます。これは、その場で画像のリサイズを行うことができ、WooCommerce 3.3.2以降、背景再生の代わりに使用されます。

## 代わりにJetpack Photonを使う

[Jetpack](https://jetpack.com/)は、WordPress.comのメーカーであるAutomattic社によるプラグインです。WordPress.comでホストされているサイトで利用可能な機能の一部を、セルフホストWordPressサイトに提供します。

[Photonモジュール](https://jetpack.com/support/photon/)は、WordPress.comのグローバル・コンテンツ・デリバリー・ネットワーク(CDN)からサイト上の画像を提供するようにし、画像の読み込みを高速化します。 

Photonはサムネイルをその場で作成できるため、背景画像の再生機能を使用する必要がありません。
